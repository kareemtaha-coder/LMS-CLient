<form
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
  class="p-6 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 space-y-6 animate-fade-in"
>
  <div class="flex justify-between items-center">
    <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100 flex items-center gap-3">
      <span class="flex items-center justify-center h-8 w-8 rounded-lg bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd" />
        </svg>
      </span>
      {{ initialData ? 'تحرير نص' : 'إضافة نص' }}
    </h3>
    <div class="flex items-center gap-2" title="نوع الملاحظة">
      @for(note of noteTypes; track note.type) {
        <button
          type="button"
          (click)="selectNoteType(note.type)"
          [title]="note.label"
          class="w-8 h-8 rounded-full transition-all duration-200 ease-in-out hover:scale-110 focus:outline-none flex items-center justify-center"
          [ngClass]="{
            'ring-2 ring-offset-2 dark:ring-offset-slate-800': form.controls.noteType.value === note.type,
            'bg-slate-300 dark:bg-slate-600 ring-slate-400 text-slate-800 dark:text-slate-200': note.type === 0,
            'bg-blue-500 dark:bg-blue-500 ring-blue-400 text-white': note.type === 1,
            'bg-amber-400 dark:bg-amber-400 ring-amber-300 text-white': note.type === 2,
            'bg-teal-400 dark:bg-teal-400 ring-teal-300 text-white': note.type === 3
          }"
        >
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path [attr.d]="note.icon" /></svg>
        </button>
      }
    </div>
  </div>

  <div class="relative">
    <input
      type="text"
      id="title"
      formControlName="title"
      class="block px-3 py-2.5 w-full text-sm text-slate-900 bg-transparent rounded-lg border-2 appearance-none focus:outline-none focus:ring-0 peer"
      [ngClass]="{
        'border-slate-300 dark:border-slate-600 focus:border-blue-600': !isInvalid('title'),
        'border-red-500 dark:border-red-500 focus:border-red-600': isInvalid('title')
      }"
      placeholder=" "
    />
    <label for="title" class="absolute text-sm duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-slate-800 px-2 right-1 peer-focus:px-2 peer-focus:text-blue-600 dark:peer-focus:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4"
    [ngClass]="{'text-slate-500 dark:text-slate-400': !isInvalid('title'), 'text-red-600 dark:text-red-500': isInvalid('title')}"
    >العنوان</label>
    @if (isInvalid('title')) {
      <p class="mt-1 text-xs text-red-600 dark:text-red-500">العنوان مطلوب.</p>
    }
  </div>

  <div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <div class="quill-container">
          <div #arabicEditor class="min-h-[160px]"></div>
        </div>
        @if (isInvalid('arabicText')) {
          <p class="mt-1 text-xs text-red-600 dark:text-red-500">النص العربي مطلوب.</p>
        }
      </div>
      <div>
        <div class="quill-container">
          <div #englishEditor class="min-h-[160px]"></div>
        </div>
        @if (isInvalid('englishText')) {
          <p class="mt-1 text-xs text-red-600 dark:text-red-500">English text is required.</p>
        }
      </div>
    </div>
  </div>

  <div class="flex justify-end gap-3 pt-3">
    <button
      type="button"
      (click)="cancel.emit()"
      class="px-5 py-2 font-semibold text-slate-700 dark:text-slate-200 bg-transparent hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors"
    >
      إلغاء
    </button>
    <button
      type="submit"
      [disabled]="form.invalid"
      class="px-6 py-2.5 font-semibold text-white bg-blue-600 hover:bg-blue-700 rounded-lg disabled:bg-slate-400 disabled:cursor-not-allowed disabled:shadow-none shadow-md hover:shadow-lg transition-all"
    >
      حفظ
    </button>
  </div>
</form>

