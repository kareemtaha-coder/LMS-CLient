<div class="quiz-take-container">
  <!-- Welcome Screen -->
  @if (!isStarted() && !isSubmitted()) {
    <div class="quiz-welcome">
      <div class="welcome-header">
        <div class="quiz-icon">
          <i class="bi bi-mortarboard"></i>
        </div>
        <h2>{{ quiz.title }}</h2>
        <div class="quiz-info">
          <div class="info-item">
            <i class="bi bi-list-check"></i>
            <span>{{ quiz.questions.length }} سؤال</span>
          </div>
          <div class="info-item">
            <i class="bi bi-star-fill"></i>
            <span>كل سؤال بدرجة واحدة</span>
          </div>
          <div class="info-item">
            <i class="bi bi-clock"></i>
            <span>{{ quiz.questions.length * 2 }} دقيقة</span>
          </div>
        </div>
      </div>
      <button class="btn btn-start-quiz" (click)="startQuiz()">
        <i class="bi bi-play-circle-fill"></i>
        ابدأ الاختبار
      </button>
    </div>
  }

  <!-- Quiz Questions -->
  @if (isStarted() && !isSubmitted() && currentQuestion) {
    <div class="quiz-active">
      <div class="quiz-progress">
        <div class="progress-bar">
          <div class="progress-fill" [style.width]="((currentQuestionIndex() + 1) / quiz.questions.length * 100) + '%'"></div>
        </div>
        <div class="progress-text">
          سؤال {{ currentQuestionIndex() + 1 }} من {{ quiz.questions.length }}
        </div>
      </div>

      <div class="question-container">
        <div class="question-header">
          <span class="question-number">
            <i class="bi bi-1-circle-fill"></i>
            سؤال {{ currentQuestionIndex() + 1 }}
          </span>
          <span class="question-badge">
            <i class="bi bi-check2-square"></i>
            اختيار من متعدد
          </span>
        </div>

        <div class="question-text">{{ currentQuestion.questionText }}</div>

        <!-- Multiple Choice Answers -->
        <div class="answers-container">
          @for (answer of currentQuestion.answers; track answer.id) {
            <div class="answer-option" 
                 [class.selected]="isAnswerSelected(currentQuestion.id, answer.id)"
                 (click)="selectAnswer(currentQuestion.id, answer.id)">
              <div class="answer-radio">
                <input type="radio" 
                       [name]="'question-' + currentQuestion.id"
                       [checked]="isAnswerSelected(currentQuestion.id, answer.id)"
                       (change)="selectAnswer(currentQuestion.id, answer.id)">
              </div>
              <div class="answer-text">{{ answer.answerText }}</div>
            </div>
          }
        </div>

        <div class="quiz-navigation">
          <button class="btn btn-secondary" 
                  (click)="previousQuestion()" 
                  [disabled]="currentQuestionIndex() === 0">
            <i class="bi bi-arrow-right"></i>
            السابق
          </button>
          
          @if (currentQuestionIndex() < quiz.questions.length - 1) {
            <button class="btn btn-primary" (click)="nextQuestion()">
              التالي
              <i class="bi bi-arrow-left"></i>
            </button>
          } @else {
            <button class="btn btn-success" (click)="submitQuiz()">
              <i class="bi bi-check-circle"></i>
              إنهاء الاختبار
            </button>
          }
        </div>
      </div>
    </div>
  }

  <!-- Results Screen -->
  @if (isSubmitted()) {
    <div class="quiz-results">
      <div class="results-header">
        <div class="score-circle" [class.passed]="getScore().percentage >= 50">
          <div class="score-value">{{ getScore().percentage }}%</div>
          <div class="score-label">النتيجة</div>
        </div>
        <h3>{{ getScore().percentage >= 50 ? 'تهانينا! لقد نجحت' : 'للأسف، لم تنجح' }}</h3>
        <p>{{ getScore().correct }} من {{ getScore().total }} إجابة صحيحة</p>
      </div>

      <div class="results-details">
        <h4>تفاصيل الإجابات</h4>
        @for (question of quiz.questions; track question.id; let i = $index) {
          <div class="result-question">
            <div class="result-question-header">
              <span class="question-number">سؤال {{ i + 1 }}</span>
              @if (isAnswerCorrect(question, selectedAnswers().get(question.id) || '')) {
                <span class="result-badge correct">
                  <i class="bi bi-check-circle-fill"></i>
                  صحيح
                </span>
              } @else {
                <span class="result-badge incorrect">
                  <i class="bi bi-x-circle-fill"></i>
                  خاطئ
                </span>
              }
            </div>
            <div class="result-question-text">{{ question.questionText }}</div>
            <div class="result-answers">
              @for (answer of question.answers; track answer.id) {
                <div class="result-answer" 
                     [class.selected]="selectedAnswers().get(question.id) === answer.id"
                     [class.correct]="answer.isCorrect">
                  <span class="answer-text">{{ answer.answerText }}</span>
                  @if (answer.isCorrect) {
                    <i class="bi bi-check-circle-fill"></i>
                  }
                  @if (selectedAnswers().get(question.id) === answer.id && !answer.isCorrect) {
                    <i class="bi bi-x-circle-fill"></i>
                  }
                </div>
              }
            </div>
          </div>
        }
      </div>

      <div class="results-actions">
        <button class="btn btn-primary" (click)="retakeQuiz()">
          <i class="bi bi-arrow-clockwise"></i>
          إعادة المحاولة
        </button>
      </div>
    </div>
  }
</div>
